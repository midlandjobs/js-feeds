<!DOCTYPE html>
<html lang="en-gb" dir="ltr">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Project - feeds script</title>
  <link rel="icon" href="img/favicon.ico">

  <!-- load UIKIT from CDN -->
  <!-- <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/uikit@3.16.17/dist/css/uikit.min.css" /> -->
  <link rel="stylesheet" href="css/base.css" />
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.17/dist/js/uikit.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/uikit@3.16.17/dist/js/uikit-icons.min.js"></script>

  <!-- or load UIKIT from base-theme -->
  <!-- <script async src="https://raw.githack.com/robmccormack89/base-theme/coffeee/assets/js/base.js"></script>
    <link rel="stylesheet" href="https://raw.githack.com/robmccormack89/base-theme/coffeee/assets/css/base.css" /> -->

  <!-- load a script from github: raw -->
  <!-- <script src="https://raw.githack.com/midlandjobs/myjobsfeed/src/myjobsfeed.js"></script> -->

  <!-- example initilization of this project  -->
  <!-- <script>
      const my_first_jobs_feed = new smartjobboardFeed('#MyJobFeed', {

        // Optional parameters. Jobs feed settings
        employer: 'Mergon', 
        keywords: '',
        categories: '',
        job_type: '',
        location: '',
        featured_only: '',
        products: '',
        exclude_imports: '',
        jobs_limit: '',
        utm_source: '',

        // Optional parameters. Visual settings
        type: 'carousel',

        direction: 'horizontal', // Can be 'horizontal' or 'vertical' (for vertical carousel).
        loop: true, // Set to true to enable continuous loop mode

        pagination: true, // If we need pagination
        navigation: true, // Navigation arrows
        scrollbar: true, // And if we need scrollbar

        // Default View parameters
        jobsPerView: 1,
        spaceBetween: 10,

        // Responsive View breakpoints
        breakpoints: {
          // when window width is 320px or above
          320: {
            jobsPerView: 2,
            spaceBetween: 20
          },
          // when window width is 480px or above
          480: {
            jobsPerView: 3,
            spaceBetween: 30
          },
          // when window width is 640px or above
          640: {
            jobsPerView: 4,
            spaceBetween: 40
          }
        }

      });
    </script> -->

  <script>
    // Required by some npm packages
    // window.process = { browser: true, env: { ENVIRONMENT: 'BROWSER' } };
  </script>

  <!-- load our bundled js output -->
  <script src="main.js"></script>

  <!-- we use twing (with twig) as templating language -->
  <!-- <script src="https://cdn.jsdelivr.net/npm/twing/dist/lib.min.js"></script> -->
  <!-- <script src="https://unpkg.com/mustache@latest"></script> -->

  <!-- send as xml feed src to proxy, get the data back as json, compile it using twigJS & place it in the DOm using element ID  -->
  <!-- <script>

    class Car {
      constructor(name, year) {
        this.name = name;
        this.year = year;
      }
      age() {
        const date = new Date();
        return date.getFullYear() - this.year;
      }
    }

    // const myCar1 = new Car("Ford", 2014);
    // const myCar2 = new Car("Audi", 2019);

    // console.log(myCar1);
    // console.log(myCar2);

    // render data using twig.js (with twig template) & place it inside a DOM element using the element ID. uses fetch()
    function _compileTwigIntoElement(target_id = 'target', template = 'jobs.twig', context = { name: 'Fabien' }) {
      var target_el = document.getElementById(target_id);
      if (target_el) {
        // target_id = id of the element where compiled html will be placed into
        // template = the template file name (relative to root)
        // twig_code = whats in the file (contents, fetched from template)
        // context = variables passed to twig
        return fetch(template)
          .then((response) => response.text())
          .then((twig_code) => {
            let twing = Twing;
            let loader = new twing.TwingLoaderArray({
              [template]: twig_code
            });
            let twinger = new twing.TwingEnvironment(loader);
            let blahBlah = twinger.render(template, context).then((output) => {
              // do something with the output
              // console.log(output);
              // return output;
              document.getElementById(target_id).innerHTML = output;
            }).catch((err) => {
              console.log(err);
            });
            // console.log(blahBlah);
            // return blahBlah;
          });
      }
    }

    // on window load... this is so it doesnt matter where we place our feed-proxy script. the element on the page will be loaded regardless (if it exists)
    window.addEventListener('boogie', (event) => {

      function callToProxy(id, el, url, prox, temp, callback) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", encodeURI(prox) + "?url=" + encodeURI(url), true);
        xhr.onreadystatechange = function () {
          if (xhr.readyState == 4) {
              // defensive check
              if (typeof callback === "function") {
                  // apply() sets the meaning of "this" in the callback
                  callback.apply(xhr);
              }
          }
        };
        xhr.send();
        // xhr = null;
      }

      function callToProxAndTWigRender(id, el, url, prox, temp, rem = false){
          
        // the AJAX request to the proxy
        var xhr = (window.XMLHttpRequest ? new XMLHttpRequest() : new ActiveXObject("Microsoft.XMLHTTP"));
        xhr.onreadystatechange = XHRhandler;
        xhr.open("GET", encodeURI(prox) + "?url=" + encodeURI(url), true);
        xhr.send("foo=bar&lorem=ipsum");

        // handle AJAX response. calls compileTwigIntoElement() with parsed json data
        function XHRhandler() {
          if (xhr.readyState == 4) {

            // parse response as JSON
            var json;
            if (JSON && JSON.parse) {

              json = JSON.parse(xhr.responseText);

              // Do something with the json. e.g: Display(json)
              compileTwigIntoElement(id, temp, {
                publisher: json.publisher,
                publisher_url: json.publisherurl,
                last_build_date: json.lastBuildDate,
                jobs: json.job,
                remote: rem
              })
              // console.log(json);
              // myCallback(json);
              // return json;
              
              // console.log(json);
              // compileTwigIntoElement(id, temp, {
              //   publisher: json.publisher,
              //   publisher_url: json.publisherurl,
              //   last_build_date: json.lastBuildDate,
              //   jobs: json.job,
              //   remote: rem
              // });
              // console.log(hello);

            }
            else {
              eval("var json = " + xhr.responseText);
            }

            // end the request
            xhr = null;

          }
        }

      }

      // the following steps should be done as a loop or something; we will need to be able to do this for EACH initialization of a feed, i.e: each new Feed Object created, or something
      var target_id = 'ITFeed'
      var target_el = document.getElementById(target_id);

      // if target element exists, start our feed-proxy stuff
      if (target_el) {

        // set our XML feed & proxy srcs
        // var url = "http://" + location.hostname + location.pathname.replace(/\/[^\/]+$/,"") + "/example.xml";
        var url = "https://midlandjobs.ie/feeds/standard.xml?categories=733,701,685,697,368,702,752,737,741,735,708,753,734,686,718"; // IT jobs
        var proxy = "https://test.com/projects/xmlproxy/xmlproxy.php";
        var template = 'jobs.twig';

        // callToProxAndTWigRender(target_id, target_el, url, proxy, template);
        // var resultOne = callToProxAndTWigRender(target_id, target_el, url, proxy, template);
        // console.log(resultOne);

        // fuck() completes immediately... returns a promise
        callToProxy(target_id, target_el, url, proxy, template, 
          function () {
            // parse response as JSON
            var json;
            if (JSON && JSON.parse) {

              json = JSON.parse(this.responseText);

              console.log(json);

              // Do something with the json. e.g: Display(json)
              hello = compileTwigIntoElement(target_id, template, {
                publisher: json.publisher,
                publisher_url: json.publisherurl,
                last_build_date: json.lastBuildDate,
                jobs: json.job,
                remote: false
              })
              console.log(hello); // contains promise

            }
            else {
              eval("var json = " + this.responseText);
            }
          }
        );

      }

      // the following steps should be done as a loop or something; we will need to be able to do this for EACH initialization of a feed, i.e: each new Feed Object created, or something
      var _target_id = 'RemoteFeed'
      var _target_el = document.getElementById(_target_id);

      // if target element exists, start our feed-proxy stuff
      if (_target_el) {

        // set our XML feed & proxy srcs
        // var url = "http://" + location.hostname + location.pathname.replace(/\/[^\/]+$/,"") + "/example.xml";
        var _url = "https://midlandjobs.ie/feeds/standard.xml"; // main feed, but with remote tag
        var _proxy = "https://test.com/projects/xmlproxy/xmlproxy.php";
        var _template = 'jobs.twig';

        // callToProxAndTWigRender(_target_id, _target_el, _url, _proxy, _template, true);
        // var resultTwo = callToProxAndTWigRender(_target_id, _target_el, _url, _proxy, _template, true);
        // console.log(resultTwo);

        // fuck() completes immediately... returns a promise
        callToProxy(_target_id, _target_el, _url, _proxy, _template, 
          function () {
            // parse response as JSON
            var json;
            if (JSON && JSON.parse) {

              json = JSON.parse(this.responseText);

              console.log(json);

              // Do something with the json. e.g: Display(json)
              byee = compileTwigIntoElement(_target_id, _template, {
                publisher: json.publisher,
                publisher_url: json.publisherurl,
                last_build_date: json.lastBuildDate,
                jobs: json.job,
                remote: true
              })
              console.log(byee); // contains promise

            }
            else {
              eval("var json = " + this.responseText);
            }
          }
        );

      }

    });

  </script> -->

</head>

<body>

  <div id="UikitSections" class="">

    <section id="One" class="uk-section uk-light uk-background-cover uk-position-relative"
      style="background-image: url(https://picsum.photos/1920/800?random=1)">
      <div class="uk-overlay-primary uk-position-cover"></div>
      <div class="uk-container uk-position-relative uk-position-z-index">
        <h3>Section with Images</h3>
        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>
      </div>
    </section>

    <section id="Two" class="uk-section uk-section-small uk-section-default">
      <div class="uk-container">

        <h3>Section Default</h3>

        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>

      </div>
    </section>

    <section id="Three" class="uk-section uk-section-muted">
      <div class="uk-container">

        <h3>Section Muted</h3>

        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>

      </div>
    </section>

    <section id="Four" class="uk-section uk-section-primary uk-light">
      <div class="uk-container">

        <h3>Section Primary</h3>

        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>

      </div>
    </section>

    <div class="project">
      <div class="project-container">

      <section class="uk-section uk-section-default">
        <div id="ITFeed" class="uk-container">Loading...</div>
      </section>
    
      <section class="uk-section uk-section-muted">
        <div id="RemoteFeed" class="uk-container uk-container-small">Loading...</div>
      </section>

      </div>
    </div>

    <section id="Five" class="uk-section uk-section-secondary uk-light">
      <div class="uk-container">

        <h3>Section Secondary</h3>

        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>

      </div>
    </section>

    <section id="Six" class="uk-section uk-light uk-background-cover uk-position-relative"
      style="background-image: url(https://picsum.photos/1920/800?random=2)">
      <div class="uk-overlay-primary uk-position-cover"></div>
      <div class="uk-container uk-position-relative uk-position-z-index">
        <h3>Section with Images</h3>
        <div class="uk-grid-match uk-child-width-1-3@m" uk-grid>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
          <div>
            <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor.</p>
          </div>
        </div>
      </div>
    </section>

  </div>




  

<!-- you can place these scripts anywhere in your page. but ideally in the HEAD or below the BODY of your HTML document (best in the HEAD) -->
<script src="https://raw.githack.com/midlandjobs/myjobsfeed/src/myjobsfeed.js"></script>
<script>
  (async () => {
    await new MidlandJobsFeed('MyJobsFeed', 'https://midlandjobs.ie/feeds/standard.xml', {remote: true});
  })();
</script>







<!-- the html element upon which the above scripts will work. the feed will be inserted inside this html element -->
<div id="MyJobsFeed"></div>
































  <script>
    const argsObj = {

      // Optional parameters. Jobs feed settings
      employer: 'Mergon', 
      keywords: '',
      categories: '',
      job_type: '',
      location: '',
      featured_only: '',
      products: '',
      exclude_imports: '',
      jobs_limit: '',
      utm_source: '',

      // Optional parameters. Visual settings
      type: 'carousel',

      direction: 'horizontal', // Can be 'horizontal' or 'vertical' (for vertical carousel).
      loop: true, // Set to true to enable continuous loop mode

      pagination: true, // If we need pagination
      navigation: true, // Navigation arrows
      scrollbar: true, // And if we need scrollbar

      // Default View parameters
      jobsPerView: 1,
      spaceBetween: 10,

      // Responsive View breakpoints
      breakpoints: {
        // when window width is 320px or above
        320: {
          jobsPerView: 2,
          spaceBetween: 20
        },
        // when window width is 480px or above
        480: {
          jobsPerView: 3,
          spaceBetween: 30
        },
        // when window width is 640px or above
        640: {
          jobsPerView: 4,
          spaceBetween: 40
        }
      }

    };
    // const feedOne = new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
    // await feedOne.initialize();
    // console.log(feedOne.getStuff());


      // let blech = await new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
      // console.log(blech);
      // Any code here will be executed after the books variable has the value.
      // (async () => {})()

      (async () => {
        await new MidlandJobsFeed('MyJobsFeed', 'https://midlandjobs.ie/feeds/standard.xml', {remote: true});
      })();

      // async function yql () {
      //   console.log('Constructing...');
      //   const obj = await new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
      //   console.log('Done:', obj);
      // }

      // yql();

      // const foo = await new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
      // console.log(foo);

    // await feedOne.getFeedHtml();
    // console.log(await feedOne.getFeedHtml());
    // console.log(smartjobboardFeed.getFeedHtml(feedOne));
    // feedOne.getFeedHtml()
    // .then((html) => {
    //   console.log(html);
    // })
    // feedOne.doTheThing();
    
    class Foo {

      constructor(name) {

        this.name = name + ' McCormack'

      }

       getName(){
        return this.name;
      }

    }

    class Foos {

      constructor(name) {

        return (async () => {

          // await anything you want

          this.name = name + ' McCormack'

          return this; // Return the newly-created instance

        })();

      }

       getName(){
        return this.name;
      }

    }

    (async () => {
      console.log('1:');
      console.log(await new Foo('Robert')); // prints obj: {name: robert}
    })();

    const gettingName = async (name) => {
      return await new Foo(name); // returns a promise
    }
    console.log('2:');
    console.log('async function wrapper, calling on method: ' + gettingName('Robert')); // prints a promise of name: robert from Foo

    console.log('3:');
    console.log('output the object direct: ' + new Foo('Robert')); // prints obj: {name: robert}

    (async () => {
      let someObj = await new Foo('Robert');
      console.log('4:');
      console.log('create var from obj & call method on it: ' + someObj.getName()); // prints obj: {name: robert}
    })();
















    (async () => {
      const bar = await new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
      // console.log(bar); // prints obj
    })();

    const getBleh = async () => {
      const data = await new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
      return data; // returns a promise
    }
    // console.log(getBleh('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj)); // prints a promise of object

    let myObj = new smartjobboardFeed('ITFeed', 'https://midlandjobs.ie/feeds/standard.xml', argsObj);
    // console.log(myObj.getFeedHtml()); // prints obj: {name: robert}

    // old, disabled
    something = false;
    if(something){

      function getCodeFromTwigTemplate(template) {
        return fetch(template).then((response) => response.text())
      }
      function getJsonViaProxy(url) {
        return fetch(url).then(response => response.json());
      }
      function renderContentUsingTwigCode(template, twig_code, context, callback) {
        let twing = Twing;
        let loader = new twing.TwingLoaderArray({
          [template]: twig_code
        });
        let twinger = new twing.TwingEnvironment(loader);
        twinger.render(template, context).then((output) => {
          callback(output)
        });
      }

      // vars
      var id = 'ITFeed'
      var url = "https://midlandjobs.ie/feeds/standard.xml?categories=733,701,685,697,368,702,752,737,741,735,708,753,734,686,718"; // IT jobs
      var proxy = "https://test.com/projects/xmlproxy/xmlproxy.php";
      var proxy_url = encodeURI(proxy) + "?url=" + encodeURI(url);
      var template = 'jobs.twig';
      var target = document.getElementById(id);
      var target = false;

      if (target){

        // get data via proxy as json, then....
        getJsonViaProxy(proxy_url).then(json => {

          // we have json now, what next... we set the context variable from the json..
          context = {
            publisher: json.publisher,
            publisher_url: json.publisherurl,
            last_build_date: json.lastBuildDate,
            jobs: json.job,
            remote: false
          }

          // get the twig code from its twig template...
          getCodeFromTwigTemplate(template).then(twig_code => {

            // then render our content using the twig code. then place it in the DOM via a calback
            renderContentUsingTwigCode(template, twig_code, context, function(resulting_html){
              target.innerHTML = resulting_html;
            });

          });

        });

      }
  
    }
  
  </script>
























  <!-- <script>
      var sticky = UIkit.sticky('#One', {
        // offset: 50
      });
      var stickyish = UIkit.sticky('#One');
    </script> -->

  <!-- <script>myFunction1();</script> -->

</body>

</html>

















